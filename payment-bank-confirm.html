<!doctype html>
<html lang="ja" class="no-js no-svg">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J2TLPK5HQH"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-J2TLPK5HQH');
  </script>
  <!-- Google Tag Manager -->
  <script>
    (function(w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
      });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-PQ8S3354');
  </script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    (function() {
      var host = window.location.hostname;
      var path = window.location.pathname;
      var base = "/";
      if (host.endsWith("github.io")) {
        var parts = path.split("/").filter(Boolean);
        base = parts.length ? "/" + parts[0] + "/" : "/";
      }
      var baseTag = document.createElement("base");
      baseTag.href = base;
      document.head.appendChild(baseTag);
    })();
  </script>
  <title>銀行振込の確認</title>
  <link rel="icon" href="assets/img/common/favicon.ico">
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PQ8S3354" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <div id="site-header"></div><main id="l-main">
    <div class="l-container p-contact">
      <div class="l-inner">
        <div class="p-contact__top">
          <h2 class="p-contact__h2 sec-h2">銀行振込の確認</h2>
        </div>

        <p class="p-contact__lead">以下の内容で申し込みを確定します。よろしければ「注文を確定する」を押してください。</p>

        <form class="wpcf7-form" action="payment-bank-done.html" method="get" data-gas-endpoint="https://script.google.com/macros/s/AKfycbw4YWWxECYld21hPHUlAPDJnPFbb1iyhE6aXTnAea7Y9hbiuQ3fNLGfKC9jnNjnOg/exec">
          <input type="hidden" name="action">
          <input type="hidden" name="product_id">
          <input type="hidden" name="product_name">
          <input type="hidden" name="amount">
          <input type="hidden" name="currency">
          <input type="hidden" name="payment_method">
          <input type="hidden" name="billing_first_name">
          <input type="hidden" name="billing_last_name">
          <input type="hidden" name="billing_email">
          <input type="hidden" name="order_comments">
          <table class="p-contact__confirm">
            <tr>
              <th>お名前</th>
              <td data-field="customer-name"></td>
            </tr>
            <tr>
              <th>メールアドレス</th>
              <td data-field="billing_email"></td>
            </tr>
            <tr>
              <th>商品名</th>
              <td data-field="product_name"></td>
            </tr>
            <tr>
              <th>金額</th>
              <td data-field="amount"></td>
            </tr>
            <tr>
              <th>備考</th>
              <td data-field="order_comments"></td>
            </tr>
          </table>
          <div class="submit">
            <button type="button" class="wpcf7-submit" id="back-button">修正する</button>
            <button type="submit" class="wpcf7-submit">注文を確定する</button>
            <p class="p-contact__loading" id="payment-loading" aria-live="polite">送信中です…</p>
          </div>
        </form>
      </div>
    </div>
  </main><div id="site-footer"></div>
<script src="assets/js/include.js"></script>
<script>
  (function() {
    var params = new URLSearchParams(window.location.search);
    var fields = [
      'action',
      'product_id',
      'product_name',
      'amount',
      'currency',
      'payment_method',
      'billing_first_name',
      'billing_last_name',
      'billing_email',
      'order_comments'
    ];
    fields.forEach(function(name) {
      var value = params.get(name) || '';
      var cell = document.querySelector('[data-field="' + name + '"]');
      if (cell) {
        cell.textContent = value;
      }
      var input = document.querySelector('input[type="hidden"][name="' + name + '"]');
      if (input) {
        input.value = value;
      }
    });
    var lastName = params.get('billing_last_name') || '';
    var firstName = params.get('billing_first_name') || '';
    var nameCell = document.querySelector('[data-field="customer-name"]');
    if (nameCell) {
      nameCell.textContent = (lastName + ' ' + firstName).trim();
    }
    var amountCell = document.querySelector('[data-field="amount"]');
    var amountValue = params.get('amount') || '';
    if (amountCell && amountValue) {
      var amountNumber = Number(amountValue);
      if (!isNaN(amountNumber)) {
        amountCell.textContent = '¥' + amountNumber.toLocaleString('ja-JP');
      }
    }
    var backButton = document.getElementById('back-button');
    if (backButton) {
      backButton.addEventListener('click', function() {
        history.back();
      });
    }
    var form = document.querySelector('form.wpcf7-form');
    if (!form) {
      return;
    }
    form.addEventListener('submit', function(event) {
      event.preventDefault();
      if (form.dataset.submitting === 'true') {
        return;
      }
      form.dataset.submitting = 'true';
      var loading = document.getElementById('payment-loading');
      if (loading) {
        loading.style.display = 'block';
      }
      var buttons = form.querySelectorAll('.wpcf7-submit');
      buttons.forEach(function(button) {
        button.disabled = true;
      });
      var endpoint = form.getAttribute('data-gas-endpoint');
      var payload = new URLSearchParams(new FormData(form));
      fetch(endpoint, {
        method: 'POST',
        mode: 'cors',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
        },
        body: payload.toString()
      }).then(function(response) {
        if (!response.ok) {
          throw new Error('Request failed');
        }
        return response.json();
      }).then(function(data) {
        if (!data || !data.ok) {
          throw new Error('Request failed');
        }
        window.location.href = 'payment-bank-done.html';
      }).catch(function() {
        alert('送信に失敗しました。時間をおいて再度お試しください。');
        form.dataset.submitting = 'false';
        if (loading) {
          loading.style.display = 'none';
        }
        buttons.forEach(function(button) {
          button.disabled = false;
        });
      });
    });
  })();
</script>
</body>

</html>
